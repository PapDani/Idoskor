<section class="wrap">
  <div class="head">
    <h1>{{ isEdit ? 'Kártya szerkesztése' : 'Új kártya' }}</h1>
    <button mat-button type="button" (click)="goBack()">← Vissza a listához</button>
  </div>

  <div class="layout">
    <!-- Bal: űrlap -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form">
      <mat-form-field appearance="outline" class="field">
        <mat-label>Cím</mat-label>
        <input matInput formControlName="title" placeholder="Kártya címe" required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="field">
        <mat-label>Kép URL</mat-label>
        <input matInput formControlName="imageUrl" placeholder="/uploads/...">
      </mat-form-field>

      <div class="upload">
        <label class="lbl">Kép feltöltése</label>
        <input type="file" accept="image/*" (change)="onFileChange($event)">
        <small class="muted">Fájl kiválasztásakor feltöltjük, és automatikusan kitöltjük a „Kép URL” mezőt.</small>
      </div>

      <mat-form-field appearance="outline" class="field">
        <mat-label>Külső link (opcionális)</mat-label>
        <textarea matInput rows="3" formControlName="contentUrl" placeholder="https://..."></textarea>
      </mat-form-field>

      <div class="actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
          {{ isEdit ? 'Mentés' : 'Kártya létrehozása' }}
        </button>
        <button mat-stroked-button color="warn" type="button" (click)="onDelete()" *ngIf="isEdit">Törlés</button>
      </div>
    </form>

    <!-- Jobb: élő előnézet -->
    <div class="preview">
      <mat-card class="card">
        <ng-container *ngIf="previewUrl; else noimg">
          <img mat-card-image [src]="previewUrl" [alt]="form.controls.title.value || 'Előnézet'">
        </ng-container>
        <ng-template #noimg>
          <div class="img-ph" aria-label="Nincs kép"></div>
        </ng-template>

        <mat-card-title class="ttl">
          {{ form.controls.title.value || 'A cím itt jelenik meg' }}
        </mat-card-title>

        <mat-card-content class="cnt">
          <p>{{ form.controls.contentUrl.value || 'A tartalom/link itt jelenik meg' }}</p>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</section>

<style>
  .wrap {
    max-width: 1100px;
    margin: 1rem auto;
    padding: 0 1rem
  }

  .head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: .75rem
  }

  .layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem
  }

  @media (max-width: 900px) {
    .layout {
      grid-template-columns: 1fr
    }
  }

  .form {
    display: grid;
    gap: .75rem;
    align-content: start
  }

  .field {
    width: 100%
  }

  .upload {
    display: flex;
    flex-direction: column;
    gap: .25rem
  }

  .lbl {
    font-weight: 600
  }

  .muted {
    color: #777
  }

  .preview {
    align-self: start
  }

  .card {
    border-radius: 12px;
    overflow: hidden
  }

  .img-ph {
    height: 160px;
    border-radius: 12px;
    background: linear-gradient(135deg,#eaeaea,#f5f5f5)
  }

  .ttl {
    margin: .5rem .75rem 0
  }

  .cnt {
    padding: .25rem .75rem .75rem
  }
</style>
